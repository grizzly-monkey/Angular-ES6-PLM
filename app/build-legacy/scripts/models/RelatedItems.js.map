{"version":3,"sources":["../../../scripts/models/RelatedItems.js"],"names":[],"mappings":"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","file":"RelatedItems.js","sourcesContent":["'use strict';\n\n/**\n * @ngdoc object\n * @name Models.RelatedItems\n *\n * @description This class wraps a list of RelatedItems payload into an object\n *\n * ##Dependencies\n *\n */\n\nvar RelatedItems = function () {};\n\nRelatedItems.prototype = {\n\t/**\n\t * @ngdoc method\n\t * @name Models.RelatedItems#fetch\n\t * @methodOf Models.RelatedItems\n\t * @description Make a call to fetch raw data\n\t *\n\t * @param {String} link The URL to use for fetching the data\n\t *\n\t * @returns {Object} An object representation of the formatted data\n\t */\n\tfetch: function (link) {\n\t\tvar that = this;\n\t\treturn this.RESTWrapperService.get(link, null, null, {}).then(function (payload) {\n\t\t\tthat.json = [];\n\n\t\t\tangular.forEach(payload, function (item, index) {\n\t\t\t\t/* global RelatedItem */\n\t\t\t\tthat.json[index] = new RelatedItem(item);\n\t\t\t}, that);\n\n\t\t\treturn that;\n\t\t});\n\t},\n\n\t/**\n\t * @ngdoc method\n\t * @name Models.RelatedItems#getFullList\n\t * @methodOf Models.RelatedItems\n\t * @description Returns the full list of data\n\t *\n\t * @returns {Array} The full list of data\n\t */\n\tgetFullList: function () {\n\t\treturn angular.copy(this.json);\n\t},\n\n\t/**\n\t * @ngdoc method\n\t * @name Models.RelatedItems#save\n\t * @methodOf Models.RelatedItems\n\t * @description Saves the newly added and modified items.\n\t *\n\t * @param {Array} List of items which can be a mixture of newly added and\n\t * modified items.\n\t *\n\t * @returns {Promise} Result of saving all the items. If some or all the\n\t * items are *not* saved, the promise is rejected.\n\t */\n\tsave: function (items) {\n\t\tlet promises = this._.map(items, item => {\n\t\t\t// Call the appropriate method based on whether the item is newly\n\t\t\t// added (has an `associateItem` property) or has been modified\n\t\t\tif (item.associateItem) {\n\t\t\t\treturn this.saveAddedItem(item).then(() => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttitle: item.item.title,\n\t\t\t\t\t\turn: item.item.urn,\n\t\t\t\t\t\tisSaved: true,\n\t\t\t\t\t\tisAdded: true\n\t\t\t\t\t};\n\t\t\t\t}, () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttitle: item.item.title,\n\t\t\t\t\t\turn: item.item.urn,\n\t\t\t\t\t\tisSaved: false\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t} else if (item.descriptionField.value !== item.descriptionField.originalValue) {\n\t\t\t\treturn this.saveExistingItem(item).then(() => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttitle: item.item.title,\n\t\t\t\t\t\turn: item.item.urn,\n\t\t\t\t\t\tisSaved: true\n\t\t\t\t\t};\n\t\t\t\t}, () => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttitle: item.item.title,\n\t\t\t\t\t\turn: item.item.urn,\n\t\t\t\t\t\tisSaved: false\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// Filter out undefineds (since _.map is used)\n\t\treturn this.$q.all(_.filter(promises));\n\t},\n\n\t/**\n\t * @ngdoc method\n\t * @name Models.RelatedItems#saveExistingItem\n\t * @methodOf Models.RelatedItems\n\t * @description Saves an existing item (PUT request).\n\t *\n\t * @param {Object} The item to be saved.\n\t *\n\t * @returns {Promise} Result of saving the item.\n\t */\n\tsaveExistingItem: function (item) {\n\t\tlet data = {\n\t\t\tdirection: item.direction,\n\t\t\tdescription: item.descriptionField.value\n\t\t};\n\n\t\treturn this.RESTWrapperService.put(data, item.__self__.substring(1), null, null, null, {});\n\t},\n\n\t/**\n\t * @ngdoc method\n\t * @name Models.RelatedItems#saveAddedItem\n\t * @methodOf Models.RelatedItems\n\t * @description Saves a newly added item (POST request).\n\t *\n\t * @param {Object} The item to be saved.\n\t *\n\t * @returns {Promise} Result of saving the item.\n\t */\n\tsaveAddedItem: function (item) {\n\t\tlet locationUrl = item.__self__;\n\t\tlet data = {\n\t\t\tdirection: {\n\t\t\t\ttype: item.directionField.value.link\n\t\t\t},\n\t\t\tdescription: item.descriptionField.value\n\t\t};\n\t\tlet base = 'api/v3';\n\t\tlet path = [\n\t\t\t{workspaces: item.associateItem.workspaceId},\n\t\t\t{items: item.associateItem.itemId},\n\t\t\t'views/10'\n\t\t];\n\t\tlet params = null;\n\t\tlet headers = {\n\t\t\t'Content-Location': locationUrl\n\t\t};\n\t\tlet options = {};\n\n\t\treturn this.RESTWrapperService.post(data, base, path, params, headers, options);\n\t}\n};\n\nangular.module('plm360.models').factory('RelatedItems', [\n\t'RESTWrapperService',\n\t'EventService',\n\t'ModelsManager',\n\t'$q',\n\t'_',\n\tfunction (RESTWrapperService, EventService, ModelsManager, $q, _) {\n\t\tvar models = {};\n\t\tRelatedItems.prototype.RESTWrapperService = RESTWrapperService;\n\t\tRelatedItems.prototype.$q = $q;\n\t\tRelatedItems.prototype._ = _;\n\n\t\tEventService.listen('relatedItems:*:get', function (event, params) {\n\t\t\tvar model = models[params] || new RelatedItems();\n\t\t\tmodels[params] = model;\n\t\t\tmodel.fetch(params).then(function (obj) {\n\t\t\t\tEventService.send('relatedItems:' + event.split(':')[1] + ':done', obj);\n\t\t\t});\n\t\t});\n\n\t\tEventService.listen('relatedItems:*:save', function (event, obj, itemList) {\n\t\t\tobj.save(itemList).then(results => {\n\t\t\t\tModelsManager.resetModels();\n\t\t\t\tEventService.send(`relatedItems:${event.split(':')[1]}:saveDone`, results);\n\t\t\t});\n\t\t});\n\n\t\treturn RelatedItems;\n\t}\n]);\n"]}